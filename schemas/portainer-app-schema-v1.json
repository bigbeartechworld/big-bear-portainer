{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/bigbeartechworld/big-bear-portainer/schemas/portainer-app-schema-v1.json",
  "title": "Portainer App Schema",
  "description": "JSON Schema for validating Portainer application structure and templates",
  "type": "object",
  "definitions": {
    "template": {
      "type": "object",
      "description": "Portainer app template entry in templates.json",
      "required": ["type", "title", "name", "description", "categories", "platform", "logo", "repository"],
      "properties": {
        "type": {
          "type": "integer",
          "description": "Template type: 1=Container, 2=Swarm, 3=Compose",
          "enum": [1, 2, 3]
        },
        "title": {
          "type": "string",
          "description": "Application display title",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "description": "Stack/container name",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Application description",
          "minLength": 1
        },
        "categories": {
          "type": "array",
          "description": "Application categories",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1
        },
        "platform": {
          "type": "string",
          "description": "Target platform",
          "enum": ["linux", "windows"]
        },
        "logo": {
          "type": "string",
          "description": "Logo URL (must be https)",
          "format": "uri",
          "pattern": "^https://"
        },
        "repository": {
          "type": "object",
          "description": "Repository information for compose stack",
          "required": ["url", "stackfile"],
          "properties": {
            "url": {
              "type": "string",
              "description": "Repository URL (must be https GitHub URL)",
              "format": "uri",
              "pattern": "^https://github\\.com/"
            },
            "stackfile": {
              "type": "string",
              "description": "Path to docker-compose.yml file in repository",
              "pattern": "^Apps/[a-z0-9-]+/docker-compose\\.yml$"
            }
          }
        },
        "env": {
          "type": "array",
          "description": "Environment variable definitions",
          "items": {
            "type": "object",
            "required": ["name", "label"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Environment variable name (UPPERCASE_WITH_UNDERSCORES)",
                "pattern": "^[A-Z][A-Z0-9_]*$"
              },
              "label": {
                "type": "string",
                "description": "Human-readable label",
                "minLength": 1
              },
              "description": {
                "type": "string",
                "description": "Variable description"
              },
              "default": {
                "type": "string",
                "description": "Default value"
              },
              "preset": {
                "type": "boolean",
                "description": "Whether value is preset"
              },
              "select": {
                "type": "array",
                "description": "Allowed values for select input",
                "items": {
                  "type": "object",
                  "required": ["text", "value"],
                  "properties": {
                    "text": {
                      "type": "string"
                    },
                    "value": {
                      "type": "string"
                    },
                    "default": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          }
        },
        "ports": {
          "type": "array",
          "description": "Port mappings (for type 1 - Container)",
          "items": {
            "type": "string",
            "pattern": "^[0-9]+:[0-9]+(/tcp|/udp)?$"
          }
        },
        "volumes": {
          "type": "array",
          "description": "Volume mappings (for type 1 - Container)",
          "items": {
            "type": "object",
            "required": ["container"],
            "properties": {
              "container": {
                "type": "string",
                "description": "Container path"
              },
              "bind": {
                "type": "string",
                "description": "Host bind path"
              }
            }
          }
        },
        "image": {
          "type": "string",
          "description": "Docker image (for type 1 - Container)"
        },
        "restart_policy": {
          "type": "string",
          "description": "Restart policy (for type 1 - Container)",
          "enum": ["no", "always", "on-failure", "unless-stopped"]
        },
        "note": {
          "type": "string",
          "description": "Additional notes or instructions"
        },
        "administrator_only": {
          "type": "boolean",
          "description": "Restrict to administrators"
        }
      }
    },
    "templatesFile": {
      "type": "object",
      "description": "Root templates.json file structure",
      "required": ["version", "templates"],
      "properties": {
        "version": {
          "type": "string",
          "description": "Templates file format version",
          "pattern": "^[0-9]+$"
        },
        "templates": {
          "type": "array",
          "description": "Array of template definitions",
          "items": {
            "$ref": "#/definitions/template"
          },
          "minItems": 1
        }
      }
    },
    "dockerCompose": {
      "type": "object",
      "description": "Docker Compose file (docker-compose.yml) in Apps/{appId}/ folder",
      "properties": {
        "version": {
          "type": "string",
          "description": "Docker Compose version (optional)"
        },
        "services": {
          "type": "object",
          "description": "Service definitions",
          "minProperties": 1
        },
        "networks": {
          "type": "object",
          "description": "Network definitions"
        },
        "volumes": {
          "type": "object",
          "description": "Named volume definitions"
        }
      }
    }
  },
  "properties": {
    "appId": {
      "type": "string",
      "description": "Application identifier (folder name in Apps/)",
      "pattern": "^[a-z0-9-]+$"
    },
    "templatesFile": {
      "$ref": "#/definitions/templatesFile"
    },
    "dockerCompose": {
      "$ref": "#/definitions/dockerCompose"
    }
  },
  "notes": [
    "Repository structure: Apps/{appId}/docker-compose.yml + root templates.json",
    "Each app must have a docker-compose.yml file in Apps/{appId}/ folder",
    "All apps must be registered in root templates.json file",
    "Template IDs must be unique across all templates",
    "Template names should be unique (lowercase app identifier preferred)",
    "Repository.stackfile must point to Apps/{appId}/docker-compose.yml",
    "Logo URL must use https protocol",
    "Repository URL must be GitHub https URL",
    "Environment variable names should follow UPPERCASE_WITH_UNDERSCORES convention",
    "Categories should match Portainer's predefined categories when possible",
    "Platform is typically 'linux' for most apps",
    "Type 3 (Compose) is recommended for multi-container applications",
    "templates.json may contain control characters - parsing should be tolerant"
  ]
}
